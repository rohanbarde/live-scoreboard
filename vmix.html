<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>JUDO BHARAT â€” vMix Scoreboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --bg: #05060a;
            --panel: #0b1320;
            --accent: #ffbf3b;
            --blue-ijf-start: #0b2a8a;
            --blue-ijf-end: #07143c;
            --white-panel-start: #ffffff;
            --white-panel-end: #e8eefc;
            --yellow: #ffd24a;
            --red: #ff4b4b;
            --gold-glow: rgba(255, 215, 75, 0.35);
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            color: #e6eef6;
            font-family: Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 100%;
            margin: 0;
            padding: 0;
            height: 100vh;
        }

        .fighter-box {
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .fighter-left {
            background: linear-gradient(180deg, var(--blue-ijf-start), var(--blue-ijf-end));
            color: white;
        }

        .fighter-right {
            background: linear-gradient(180deg, var(--white-panel-start), var(--white-panel-end));
            color: black;
        }

        .fighter-name {
            font-size: 3vw;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .fighter-club {
            font-size: 2vw;
            margin-bottom: 15px;
        }

        .fighter-score {
            font-size: 5vw;
            font-weight: bold;
        }

        .match-number {
            font-size: 2.5vw;
            font-weight: bold;
            color: var(--yellow);
        }

        .weight-category {
            font-size: 2vw;
            color: var(--yellow);
            font-weight: bold;
            margin-top: 5px;
        }

        .timer-section {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #222;
            padding: 15px 0;
            text-align: center;
        }

        .timer-display {
            font-size: 8vw;
            font-weight: bold;
            display: flex;
            margin-top: -8vw;
  justify-content: center;
  color: var(--yellow);

        }

        /* Hide all controls in vMix mode */
        .btn, .operator-panel, .export-btn, .btn-close {
            display: none !important;
        }

.fighter-top-row {
    margin-bottom: 1vw;
    padding: 0 1vw;
}
.fighter-flag {
    width: 4vw;
    height: auto;
}
.fighter-club {
    font-size: 2vw;
    font-weight: bold;
    margin-left: 1vw;
}

        .fighter-name {
    font-size: 3vw;
    font-weight: bold;
    margin-bottom: 10px;
    margin-top: -20vw;
}

        .fighter-score {
    font-size: 5vw;
    font-weight: bold;
    margin-top: -8vw;
}
    </style>
</head>
<body>
<div class="container-fluid d-flex flex-column h-100 p-0">
    <!-- Player 1 (Top) -->
    <div class="fighter-box fighter-left flex-grow-1 d-flex flex-column justify-content-between">
        <div class="fighter-top-row d-flex w-100 justify-content-between align-items-start">
            <img src="flagA.png" alt="Flag A" class="fighter-flag" id="flagA" />
            <div class="fighter-club" id="fighterAClub">Team A</div>
        </div>
        <div class="fighter-name text-center" id="fighterAName">Fighter A</div>
        <div class="fighter-score text-center" id="scoreA">0</div>
    </div>

    <!-- Player 2 (Bottom) -->
    <div class="fighter-box fighter-right flex-grow-1 d-flex flex-column justify-content-between">
        <div class="fighter-top-row d-flex w-100 justify-content-between align-items-start">
            <img src="flagB.png" alt="Flag B" class="fighter-flag" id="flagB" />
            <div class="fighter-club" id="fighterBClub">Team B</div>
        </div>
        <div class="fighter-name text-center" id="fighterBName">Fighter B</div>
        <div class="fighter-score text-center" id="scoreB">0</div>
    </div>

    <!-- Bottom Bar with Timer and Match Info -->
    <div class="bottom-bar">
        <div class="match-info">
            <div class="match-number" id="matchInfo">Match 1</div>
            <div class="weight-category" id="weightCategory">-60kg</div>
        </div>
        <div class="timer-display" id="timerDisplay">04:00</div>
    </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
    // Firebase configuration - make sure this matches your main scoreboard
    const firebaseConfig = {
        apiKey: "AIzaSyDTANQqo4uFuur5WzpeSgTBz3qUwnpx9_c",
        authDomain: "maha-judo-scorecard.firebaseapp.com",
        databaseURL: "https://maha-judo-scorecard-default-rtdb.firebaseio.com",
        projectId: "maha-judo-scorecard",
        storageBucket: "maha-judo-scorecard.firebasestorage.app",
        messagingSenderId: "802933098247",
        appId: "1:802933098247:web:6a651753eb6743e01fe7a2",
        measurementId: "G-KDLM8D3ZE1"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Listen for updates from Firebase
    database.ref('current_match').on('value', (snapshot) => {
        const data = snapshot.val();
        if (!data) return;

        console.log('Received update from Firebase:', data); // Debug log

        // Update Fighter A
        if (data.fighterA) {
            const fighterA = data.fighterA;
            document.getElementById('fighterAName').textContent = fighterA.name || 'Fighter A';
            document.getElementById('fighterAClub').textContent = fighterA.club || 'Team A';
            document.getElementById('scoreA').textContent = fighterA.score || 0;
        }

        // Update Fighter B
        if (data.fighterB) {
            const fighterB = data.fighterB;
            document.getElementById('fighterBName').textContent = fighterB.name || 'Fighter B';
            document.getElementById('fighterBClub').textContent = fighterB.club || 'Team B';
            document.getElementById('scoreB').textContent = fighterB.score || 0;
        }

        // Update timer if available
        if (data.timer) {
            document.getElementById('timerDisplay').textContent = data.timer;
        }

        // Update match info if available
        if (data.matchInfo) {
            document.getElementById('matchInfo').textContent = data.matchInfo;
        }

        // Update weight category if available
        if (data.weightCategory) {
            document.getElementById('weightCategory').textContent = data.weightCategory;
        }

        // Update weight category if available
        if (data.fighterA?.weight) {
            document.getElementById('weightCategory').textContent = data.fighterA.weight;
        }
    });

    // Helper function to update shido indicators
    function updateShidoIndicators(side, count) {
        const container = document.getElementById(`shido${side}`);
        if (!container) return;
        
        const indicators = container.getElementsByClassName('shido-indicator');
        for (let i = 0; i < indicators.length; i++) {
            indicators[i].classList.toggle('active', i < count);
        }
    }

    // Auto-refresh the page every 30 minutes to prevent any potential memory leaks
    setInterval(() => {
        window.location.reload();
    }, 30 * 60 * 1000);
</script>
</body>
</html>
